import{S as ue,i as ie,s as fe,w as Q,f as h,c as A,g as E,h as _,j as J,k as d,m as z,a as O,B as R,t as L,z as le,l as U,d as B,b as de,o as me,C as ne,u as P,n as re,q as ae,y as V,A as oe,p as pe,x as be}from"./app-6d9f305e.js";import X from"./datetimepicker-01bf0f43.js";import _e from"./icons-c5a046aa.js";import ge from"./input-694295df.js";import he from"./select-5f1b2e78.js";import Se from"./button-8a7fdb21.js";import{r as G}from"./util-f704b04e.js";import"./datetimepicker.svelte_svelte_type_style_lang-ab33eabd.js";import"./moment-55cb88ed.js";import"./utils-4fba9a6a.js";import"./tw-merge-0f2443f8.js";function Y(m,t,s){const u=m.slice();return u[27]=t[s],u[29]=s,u}function Z(m,t,s){const u=m.slice();return u[27]=t[s],u[29]=s,u}function ke(m){let t=[],s=new Map,u,p,a=Q(Object.values(m[3]));const o=n=>`${n[4]}_${n[27].subjectId}`;for(let n=0;n<a.length;n+=1){let r=Z(m,a,n),c=o(r);s.set(c,t[n]=ee(c,r))}return{c(){for(let n=0;n<t.length;n+=1)t[n].c();u=be()},m(n,r){for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(n,r);J(n,u,r),p=!0},p(n,r){r&536&&(a=Q(Object.values(n[3])),V(),t=le(t,r,o,1,n,a,s,u.parentNode,oe,ee,u,Z),R())},i(n){if(!p){for(let r=0;r<a.length;r+=1)L(t[r]);p=!0}},o(n){for(let r=0;r<t.length;r+=1)O(t[r]);p=!1},d(n){n&&U(u);for(let r=0;r<t.length;r+=1)t[r].d(n)}}}function je(m){let t;return{c(){t=h("p"),t.textContent="No Course Available",_(t,"class","text-gray-500 italic")},m(s,u){J(s,t,u)},p:P,i:P,o:P,d(s){s&&U(t)}}}function ee(m,t){let s,u,p,a,o,n,r,c,f=t[27].subjectName+"",v,b,S,$,g,y,C;p=new _e({props:{icon:"check",className:`${t[27].isSelected?"stroke-green-700":"stroke-gray-300"}`}});function D(){return t[18](t[27])}return{key:m,first:null,c(){s=h("div"),u=h("button"),A(p.$$.fragment),o=E(),n=h("div"),r=h("button"),c=h("span"),v=re(f),$=E(),_(u,"class",a=`flex items-center shrink-0 justify-center h-12 w-12 border-2 ${t[27].isSelected?"border-green-700":"border-gray-300"} rounded-lg`),_(c,"class",b=`text-left text-sm ${t[27].isSelected?"text-green-700":"text-gray-400"}`),_(r,"type","button"),_(r,"class",S=`flex p-3 border-2 ${t[27].isSelected?"border-green-700":"border-gray-300"}  w-full rounded-lg items-center justify-between space-x-2`),_(n,"class","w-full"),_(s,"class","flex space-x-2 items-center w-full"),this.first=s},m(I,j){J(I,s,j),d(s,u),z(p,u,null),d(s,o),d(s,n),d(n,r),d(r,c),d(c,v),d(s,$),g=!0,y||(C=ne(u,"click",D),y=!0)},p(I,j){t=I;const i={};j&8&&(i.className=`${t[27].isSelected?"stroke-green-700":"stroke-gray-300"}`),p.$set(i),(!g||j&8&&a!==(a=`flex items-center shrink-0 justify-center h-12 w-12 border-2 ${t[27].isSelected?"border-green-700":"border-gray-300"} rounded-lg`))&&_(u,"class",a),(!g||j&8)&&f!==(f=t[27].subjectName+"")&&ae(v,f),(!g||j&8&&b!==(b=`text-left text-sm ${t[27].isSelected?"text-green-700":"text-gray-400"}`))&&_(c,"class",b),(!g||j&8&&S!==(S=`flex p-3 border-2 ${t[27].isSelected?"border-green-700":"border-gray-300"}  w-full rounded-lg items-center justify-between space-x-2`))&&_(r,"class",S)},i(I){g||(L(p.$$.fragment,I),g=!0)},o(I){O(p.$$.fragment,I),g=!1},d(I){I&&U(s),B(p),y=!1,C()}}}function te(m){let t,s,u,p,a,o;return{c(){t=h("div"),s=h("span"),s.textContent="( Some updates made by you to the schedule have not been saved )",u=E(),p=h("button"),p.textContent="Discard Updates",_(s,"class","text-xs text-gray-500 italic"),_(p,"class","text-xs text-red-500 border px-3 py-2 rounded border-red-500")},m(n,r){J(n,t,r),d(t,s),d(t,u),d(t,p),a||(o=ne(p,"click",m[14]),a=!0)},p:P,d(n){n&&U(t),a=!1,o()}}}function se(m,t){let s,u,p=t[27].subjectName+"",a,o,n,r,c,f,v,b,S,$,g,y,C;function D(...i){return t[19](t[27],...i)}c=new ge({props:{value:t[1][t[4]][t[27].subjectId].duration??"",type:"number",pattern:"[0-9]+",label:"Duration",labelStyle:"text-sm text-gray-500"}}),c.$on("input",D);function I(...i){return t[20](t[27],...i)}b=new X({props:{value:t[1][t[4]][t[27].subjectId].startDate??"",placeholder:"Enter Start Date",showLabel:!0,label:"Start Date",labelStyling:"text-sm font-normal text-gray-500 pt-[7px]"}}),b.$on("selected",I);function j(...i){return t[21](t[27],...i)}return g=new X({props:{value:t[1][t[4]][t[27].subjectId].endDate??"",placeholder:"Enter End Date",showLabel:!0,label:"End Date",labelStyling:"text-sm font-normal text-gray-500 pt-[7px]"}}),g.$on("selected",j),{key:m,first:null,c(){s=h("div"),u=h("h4"),a=re(p),o=E(),n=h("div"),r=h("div"),A(c.$$.fragment),f=E(),v=h("div"),A(b.$$.fragment),S=E(),$=h("div"),A(g.$$.fragment),y=E(),_(u,"class","text-gray-800 text-sm pb-4 font-semibold"),_(r,"class","w-24"),_(v,"class","w-[16.25rem]"),_($,"class","w-[16.25rem]"),_(n,"class","flex items-center space-x-8"),this.first=s},m(i,N){J(i,s,N),d(s,u),d(u,a),d(s,o),d(s,n),d(n,r),z(c,r,null),d(n,f),d(n,v),z(b,v,null),d(n,S),d(n,$),z(g,$,null),d(s,y),C=!0},p(i,N){t=i,(!C||N&4)&&p!==(p=t[27].subjectName+"")&&ae(a,p);const M={};N&22&&(M.value=t[1][t[4]][t[27].subjectId].duration??""),c.$set(M);const q={};N&22&&(q.value=t[1][t[4]][t[27].subjectId].startDate??""),b.$set(q);const T={};N&22&&(T.value=t[1][t[4]][t[27].subjectId].endDate??""),g.$set(T)},i(i){C||(L(c.$$.fragment,i),L(b.$$.fragment,i),L(g.$$.fragment,i),C=!0)},o(i){O(c.$$.fragment,i),O(b.$$.fragment,i),O(g.$$.fragment,i),C=!1},d(i){i&&U(s),B(c),B(b),B(g)}}}function ve(m){let t,s,u,p,a,o,n,r,c,f,v,b,S,$,g,y,C,D,I,j,i=[],N=new Map,M;a=new he({props:{value:m[4],isSelected:!!m[4],options:m[0],placeholder:m[4]?m[5]:"Select a Level",className:"text-sm py-2.5",label:"Select Level",labelStyle:"font-bold text-gray-800 text-base"}}),a.$on("deselected",m[16]),a.$on("selected",m[17]);const q=[je,ke],T=[];function H(e,l){return e[3].length==0?0:1}b=H(m),S=T[b]=q[b](m);let w=m[6]&&te(m);D=new Se({props:{disabled:m[7],buttonText:"Save & Complete",className:"min-w-max max-w-min"}}),D.$on("click",m[13]);let x=Q(Object.values(m[2]));const K=e=>`${e[4]}_${e[27].subjectId}`;for(let e=0;e<x.length;e+=1){let l=Y(m,x,e),k=K(l);N.set(k,i[e]=se(k,l))}return{c(){t=h("div"),s=h("div"),u=h("div"),p=h("div"),A(a.$$.fragment),o=E(),n=h("div"),r=h("div"),c=h("h3"),c.textContent="Courses",f=E(),v=h("div"),S.c(),$=E(),g=h("div"),y=h("div"),w&&w.c(),C=E(),A(D.$$.fragment),I=E(),j=h("div");for(let e=0;e<i.length;e+=1)i[e].c();_(p,"class","flex items-center w-full px-6 text-sm text-gray-600"),_(c,"class","text-gray-800 font-bold pb-4"),_(v,"class","space-y-2"),_(r,"class","w-full mt-4"),_(n,"class","p-6 w-full"),_(u,"class","w-[24rem] shrink-0 min-h-[20rem] py-8 border-r"),_(y,"class","flex justify-end w-full px-8 items-center space-x-3"),_(j,"class","question z-50 subjects px-8 w-full h-full space-y-6 mt-10"),_(g,"class","relative flex flex-col flex-1 w-full h-full py-8 overflow-auto"),_(s,"class","flex bg-white h-full w-full rounded-lg shadow"),_(t,"class","w-full px-8 pb-20 container")},m(e,l){J(e,t,l),d(t,s),d(s,u),d(u,p),z(a,p,null),d(u,o),d(u,n),d(n,r),d(r,c),d(r,f),d(r,v),T[b].m(v,null),d(s,$),d(s,g),d(g,y),w&&w.m(y,null),d(y,C),z(D,y,null),d(g,I),d(g,j);for(let k=0;k<i.length;k+=1)i[k]&&i[k].m(j,null);M=!0},p(e,[l]){const k={};l&16&&(k.value=e[4]),l&16&&(k.isSelected=!!e[4]),l&1&&(k.options=e[0]),l&48&&(k.placeholder=e[4]?e[5]:"Select a Level"),a.$set(k);let W=b;b=H(e),b===W?T[b].p(e,l):(V(),O(T[W],1,1,()=>{T[W]=null}),R(),S=T[b],S?S.p(e,l):(S=T[b]=q[b](e),S.c()),L(S,1),S.m(v,null)),e[6]?w?w.p(e,l):(w=te(e),w.c(),w.m(y,C)):w&&(w.d(1),w=null);const F={};l&128&&(F.disabled=e[7]),D.$set(F),l&7190&&(x=Q(Object.values(e[2])),V(),i=le(i,l,K,1,e,x,N,j,oe,se,null,Y),R())},i(e){if(!M){L(a.$$.fragment,e),L(S),L(D.$$.fragment,e);for(let l=0;l<x.length;l+=1)L(i[l]);M=!0}},o(e){O(a.$$.fragment,e),O(S),O(D.$$.fragment,e);for(let l=0;l<i.length;l+=1)O(i[l]);M=!1},d(e){e&&U(t),B(a),T[b].d(),w&&w.d(),B(D);for(let l=0;l<i.length;l+=1)i[l].d()}}}function ye(m,t,s){let u;de(m,pe,e=>s(22,u=e));let p=[],a=[],o={},n={},r=[],c=u.props.assessmentId,f,v,b=!1,S=!1;me(()=>{G.getWithToken("/api/assessment-classes/"+c,{onSuccess:e=>{s(0,p=e.data.flatMap(k=>[{placeholder:k.class_name,value:k.id}]));let l=p.flatMap(k=>[k.value]);g(l)}})});const $=async()=>{if(sessionStorage.getItem(`${c}_assessmentSubjects`)){s(1,o=JSON.parse(sessionStorage.getItem(`${c}_assessmentSubjects`))),s(4,f=sessionStorage.getItem(`${c}_selectedClassId`)),s(6,b=!0);return}await G.getWithToken("/api/assessment-subjects/"+c,{onSuccess:e=>{s(1,o=e.data)}})},g=async e=>{await G.postWithToken("/api/class/subject/",{classes:e},{onSuccess:async l=>{var k;s(15,a=l.data),await $();for(let W in a)if(o[W])for(let F in a[W])(k=Object.values(o[W]))!=null&&k.some(ce=>ce.subjectId==a[W][F].subjectId)&&s(15,a[W][F].isSelected=!0,a);f&&(s(3,r=a[f]),s(2,n=o[f]??{}))},onError:l=>{console.log(l)}})},y=(e,l)=>{s(3,r=a[e]),s(2,n=o[e]??{}),s(4,f=e),s(5,v=l),sessionStorage.setItem(`${c}_selectedClassId`,f)},C=e=>{if(o[f]||s(1,o[f]={},o),o[f][e.subjectId]){delete o[f][e.subjectId],s(15,a[f][e.subjectId].isSelected=!1,a),s(3,r=a[f]),s(2,n=o[f]),N();return}s(1,o[f][e.subjectId]=e,o),s(1,o[f][e.subjectId].published=!1,o),s(1,o),s(15,a[f][e.subjectId].isSelected=!0,a),s(3,r=a[f]),s(2,n=o[f])},D=(e,l)=>{o[f][l].duration!=e&&(s(1,o[f][l].duration=e,o),N())},I=(e,l)=>{o[f][l].startDate!=e&&(s(1,o[f][l].startDate=e,o),N())},j=(e,l)=>{o[f][l].endDate!=e&&(s(1,o[f][l].endDate=e,o),N())},i=()=>{let e={...o};s(7,S=!0),G.postWithToken("/api/assessment/termly/complete",{assessmentId:c,subjects:e,step:"complete_assessment"},{onSuccess:l=>{sessionStorage.removeItem("assessmentSubjects"),sessionStorage.removeItem("selectedClassId"),G.navigateTo("/assessments")},onError:l=>{s(7,S=!1)}})},N=()=>{let e={...o};sessionStorage.getItem(`${c}_assessmentSubjects`)&&sessionStorage.removeItem(`${c}_assessmentSubjects`),sessionStorage.setItem(`${c}_assessmentSubjects`,JSON.stringify(e)),sessionStorage.setItem(`${c}_selectedClassId`,f)},M=async()=>{sessionStorage.removeItem(`${c}_assessmentSubjects`),sessionStorage.removeItem(`${c}_selectedClassId`),s(6,b=!1),window.location.reload()},q=()=>{s(3,r=[]),s(2,n={})},T=e=>y(e.detail.value,e.detail.placeholder),H=e=>C(e),w=(e,l)=>D(l.detail.input,e.subjectId),x=(e,l)=>I(l.detail.datetime,e.subjectId),K=(e,l)=>j(l.detail.datetime,e.subjectId);return m.$$.update=()=>{m.$$.dirty&32768&&s(15,a)},[p,o,n,r,f,v,b,S,y,C,D,I,j,i,M,a,q,T,H,w,x,K]}class We extends ue{constructor(t){super(),ie(this,t,ye,ve,fe,{})}}export{We as default};
